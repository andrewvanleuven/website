---
# Documentation: https://wowchemy.com/docs/managing-content/

title: "Generating Shapefiles for Principal Cities in U.S. Core-Based Statistical Areas"
subtitle: ""
summary: " "
authors: []
tags: []
categories: []
date: 2020-07-23T16:38:54-05:00
lastmod: 2020-07-23T16:38:54-05:00
featured: false
draft: false

# Featured image
# To use, add an image named `featured.jpg/png` to your page's folder.
# Focal points: Smart, Center, TopLeft, Top, TopRight, Left, Right, BottomLeft, Bottom, BottomRight.
image:
  caption: ""
  focal_point: ""
  preview_only: false

# Projects (optional).
#   Associate this post with one or more of your projects.
#   Simply enter your project's folder or file name without extension.
#   E.g. `projects = ["internal-project"]` references `content/project/deep-learning/index.md`.
#   Otherwise, set `projects = []`.
projects: [datasci]
---

A New York Times reporter whose work I enjoy recently posted the following request on Twitter:


<p align="center">
  {{< tweet 1286380548009721857 >}}
</p>

I don't think that particular GIS shapefile exists anywhere on the web. At least, I don't think there is a ready-made shapefile of census places (e.g., cities, boroughs, towns, etc.) that is restricted only to principal cities in a CBSA. So I made one myself!

I grabbed the delineation files from [here](https://www.census.gov/geographies/reference-files/time-series/demo/metro-micro/delineation-files.html) and used a few handy GIS operations to generate a shapefile of all principal cities in US core-based statistical areas. You can find my R script [here](https://github.com/andrewvanleuven/website/blob/master/static/files/code/cbsa_city_shapefile.R).

For reference, according to the [Office of Management and Budget](https://www.govinfo.gov/content/pkg/FR-2010-06-28/html/2010-15605.htm):

> The Principal City (or Cities) of a CBSA will include:

> * The largest incorporated place with a 2010 Census population of at least 10,000 in the CBSA or, if no incorporated place of at least 10,000 population is present in the CBSA, the largest incorporated place or census designated place in the CBSA; and

> * Any additional incorporated place or census designated place with a 2010 Census population of at least 250,000 or in which 100,000 or more persons work; and

> * Any additional incorporated place or census designated place with a 2010 Census population of at least 50,000, but less than 250,000, and in which the number of workers working in the place meets or exceeds the number of workers living in the place; and

> * Any additional incorporated place or census designated place with a 2010 Census population of at least 10,000, but less than 50,000, and at least one-third the population size of the largest place, and in which the number of workers working in the place meets or exceeds the number of workers living in the place.

***

There are several possible ways to generate this shapefile. First, you can use the entire polygon---i.e., the boundary for the city's administrative jurisdictional---for every principal city in the United States. Here is a map[^1] that shows all principal cities as polygons:


[![Principal Cities in U.S. CBSAs, Polygons](/img/maps/principal_cities.png)](https://raw.githubusercontent.com/andrewvanleuven/website/master/static/img/maps/principal_cities.png)

However, that might not be very legible, as some boundaries are tiny and others are enormous. Thus, the data can also be transformed into points, generated by calculating the polygon's centroid:

[![Principal Cities in U.S. CBSAs, Points](/img/maps/principal_city_dots.png)](https://raw.githubusercontent.com/andrewvanleuven/website/master/static/img/maps/principal_city_dots.png)


One last option is whether to keep *all* principal cities in the U.S. or only those that are the largest within their CBSA. Let's look at the [Albany-Schenectady-Troy, NY MSA](https://en.wikipedia.org/wiki/Capital_District,_New_York). The largest city in the metro area is obviously Albany, but Schenectady and Troy do technically qualify as principal cities under the OMB definition above. To remove some clutter from the map, it may be useful only to plot the *largest*[^2] principal cities for each CBSA:

[![Largest Principal Cities in U.S. CBSAs, Points](/img/maps/central_principal_city_dots.png)](https://raw.githubusercontent.com/andrewvanleuven/website/master/static/img/maps/central_principal_city_dots.png)

I hope this is useful to someone down the road.

### Data

|                           | Polygons | Centroids |
|---------------------------|:--------:|:---------:|
| All Central Cities        |[.zip](https://github.com/andrewvanleuven/website/raw/master/static/files/data/shp/us_principal_cities.zip)|[.zip](https://github.com/andrewvanleuven/website/raw/master/static/files/data/shp/us_principal_city_dots.zip)|
| Largest Central City Only |[.zip](https://github.com/andrewvanleuven/website/raw/master/static/files/data/shp/biggest_principal_cities.zip)|[.zip](https://github.com/andrewvanleuven/website/raw/master/static/files/data/shp/biggest_principal_city_dots.zip)|



[^1]: In every map displayed in this post, the polygons or points that represent CBSA principal cities are shaded according to their 2010 population, mostly just for aesthetic purposes. I also plotted the lower/contiguous 48 states in the maps to keep it simple...sorry Alaska and Hawaii!

[^2]: Not pictured in this post is the *polygon* version of the largest principal cities map. A shapefile .zip is still available above.
